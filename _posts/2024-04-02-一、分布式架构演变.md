---
layout:     post     # 使用的布局（不需要改）
title:      一、分布式架构演变 
subtitle:   详解单体到分布式架构的蜕变之旅
date:       2024-04-02 # 时间
author:     Tong # 作者
header-img: img/post-bg-2015.jpg #这篇文章标题背景图片
catalog: true # 是否归档
tags: #标签
    - 分布式

typora-copy-images-to: ../assets/images
typora-root-url: ../../blog
---

## 一、传统模式的技术改革

### 1.1、最原始的单机架构

![image-20240402200205063](/assets/images/image-20240402200205063.png)

正如上图所示，这是最初的部署模式，前后端代码、静态资源都往同一个包里怼，应用程序、数据库都部署在一台服务器上！优势很明显，因为都是本机环境，内部数据交换非常快；同时运维也简单，只需要关注这一台服务器即可，部署成本非常低。

显然，这种方式虽然成本低，数据交换快，但并不能支撑太大的访问量，当流量增大时，系统很可能因为CPU、内存、带宽、磁盘等各因素出现性能问题，而一旦遇到瓶颈，为了保证系统正常运行，只能依靠“升配服务器”来解决。



#### 1.1.1、数据库隔离部署

一味的堆硬件配置，并非长久之计，尤其站在老板角度出发，单机器的配置越高，成本会呈几何倍增长，进行了第一次软件架构层面的优化：**系统应用与数据库分开部署**。

![image-20240402201128088](/assets/images/image-20240402201128088.png)

之前一股脑将所有程序部署在一起的做法，会导致业务系统和数据库，这两个不同的程序相互竞争系统资源，在流量较大的情况下，由于系统资源不够，会导致大量请求处于阻塞中；经过拆分后，资源相互隔离，在极大程度上提升了系统整体的性能。同时，就算部署业务程序的机器损坏，也不会丢失系统数据，在一定程度上也提升了系统的抗风险性。



#### 1.1.2、动静分离

随着业务不断增长，原先的系统架构出现了新瓶颈，因为数据库独立部署，而`WEB`应用服务器，即需要处理业务逻辑，又需要负责动态生成网页，同时还需要处理静态资源请求，日渐一日，系统不堪重负，在某一天下午终于倒下了……

凡事只要有第一次，就会有N多次，迫不得已的情况下，为了保证系统能正常访问，只能通过不断重启来解决问题。但这种方法治标不治本，总不能一天到晚蹲在服务器旁边重启吧？寻找并解决诱发程序频繁宕机的源头，才能真正一劳永逸！于是，踏上了排查之路。

经过一顿操作，此时观测到了问题！因为部署时，所有的静态资源（`css、js`、图片、模板……），包括运行期间用户上传的文件，统统都放在了`WEB`容器内托管，这意味着所有静态资源请求，都需要`WEB`容器来进行处理。

经过三秒钟的观测后，发现这类型的请求，占据了`60%`以上！导致频繁宕机的原因就在这里，为了解决该问题，新的优化方案是：**动静分离**。

![image-20240402202007425](/assets/images/image-20240402202007425.png)

经过动静分离的拆分优化后，所有静态资源的请求都会去到文件服务器，而与业务逻辑相关的请求，则会来到`WEB`服务器，通过这种动静分流方案，至少能减少`WEB`服务器`60~70%`请求。



#### 1.1.3、动态页面模板化

前面提到过，为了使得网页能动态加载数据，`PHP、JSP、ASP`等技术曾风靡一时，以`Java`的`JSP`技术来说，尽管实现了动态页面的效果，可页面内的数据，都需要依靠`Java`来动态填充，而渲染页面数据这个工作，放在后端来做，极为耗费时间与资源。

>因为`JSP`页面在编写时，动态数据都是用占位符来表示，运行期间，要经历读取数据、定位占位符、匹配占位符、替换占位符一系列动作，才能生成最终的网页。

可当时又没有太好的办法解决，直到`Ajax、jQuery`技术横空出世，前端可以通过`Ajax`请求，在不刷新、不跳转新页面的情况下，就可以和服务器通信，实现异步获取新的数据，这也意味着：**动态页面不再需要依靠后端来生成，前端可以异步请求服务器数据，来实现页面的数据渲染**！

放在当时，`Ajax`技术绝对是`WEB`领域革命性的突破，也是在这时，`IT`行业逐渐出现明确的前后端岗位之分，前端可以不懂后端技术，后端同理，两者相互协助，从而完成整个系统的开发。在这期间，为了避免“后端服务渲染动态页面”带来的开销，例如`Thymeleaf、FreeMarker、Velocity`等各种模板引擎技术蜂拥而至。

![image-20240402202349972](/assets/images/image-20240402202349972.png)

看过`Tomcat`源码的小伙伴应该清楚，`JSP`本质上是一个个的`Servlet`，必须依赖`WEB`容器才能使用，毕竟要靠`Java`来生成动态页面。而类似于`FreeMarker`这种模板引擎技术，可以脱离`Servlet`容器运行，不再占用`JVM`内存，很大程度上节省了`Java`生成动态页面所带来的开销。











